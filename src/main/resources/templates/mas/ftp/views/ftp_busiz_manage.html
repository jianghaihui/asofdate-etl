<div class="row subsystem-header">
    <div class="pull-left">
        <span style="font-size: 16px;">定价单元配置管理</span>
    </div>
</div>
<div class="row subsystem-toolbar">
    <div class="col-sm-12 col-md-5 col-lg-3">
        <div class="pull-left">
            <button onclick="FtpBusizObj.add()" class="btn btn-success btn-sm" title="新增机构信息">
                <i class="icon-plus"> 新增</i>
            </button>
            <button onclick="FtpBusizObj.upload()" class="btn btn-success btn-sm" title="导入机构信息">
                <span class="icon-edit"> 导入</span>
            </button>
            <button onclick="FtpBusizObj.download()" class="btn btn-success btn-sm" title="导出机构信息">
                <span class="icon-trash"> 导出</span>
            </button>
        </div>
    </div>
    <div class="col-sm-12 col-md-7 col-lg-9" style="padding-left: 0px;">
        <div class="pull-left">
            <button onclick="FtpBusizObj.edit()" class="btn btn-success btn-sm" title="编辑机构信息">
                <span class="icon-edit"> 编辑</span>
            </button>
            <button onclick="FtpBusizObj.delete()" class="btn btn-danger btn-sm" title="删除机构信息">
                <span class="icon-trash"> 删除</span>
            </button>
        </div>
        <div class="pull-right" style="height: 44px; line-height: 44px; width: 260px;">
            <span style="text-align:right;width:80px;height: 30px; line-height: 30px; margin-top: 7px;display: inline" class="pull-left">&nbsp;&nbsp;所属域：</span>
            <select id="h-ftp-busiz-domain-list" class="form-control pull-right" style="width: 180px;height: 24px; line-height: 24px; margin-top: 10px;padding: 0px;">
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12 col-md-5 col-md-3">
        <div id="h-ftp-busiz-info-tree-info" style="border: #598f56 solid 1px;">
            <div class="col-ms-12 col-md-12 col-lg-12">
                <div style="border-bottom: #598f56 solid 1px;height: 44px; line-height: 44px;">
                    <div class="pull-left">
                        <span><i class="icon-sitemap"> </i>定价规则树</span>
                    </div>
                    <div class="pull-right">
                    <span>
                        <i class=" icon-search" style="margin-top: 15px;"></i>&nbsp;
                    </span>
                    </div>
                </div>
            </div>
            <div id="h-ftp-busiz-info-tree-info-list" class="col-sm-12 col-md-12 col-lg-12"
                 style="padding:15px 5px;overflow: auto">

            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-7 col-lg-9" style="padding-left: 0px;">
        <div id="h-ftp-busiz-info-table-info" style="border: #598f56 solid 1px;">
            <div id="h-ftp-busiz-info-toolbar-list" class="pull-left">
                <span>定价单元详细信息</span>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12">
                <table id="h-ftp-busiz-info-table-details"
                       data-toggle="table"
                       data-toolbar="#h-ftp-busiz-info-toolbar-list"
                       data-side-pagination="client"
                       data-striped="true"
                       data-pagination="true"
                       data-unique-id="busiz_id"
                       data-query-params="FtpBusizObj.queryParams"
                       data-page-list="[20, 50, 100, 200]"
                       data-search="refresh">
                    <thead>
                    <tr>
                        <th data-field="state" data-checkbox="true"></th>
                        <th data-field="code_number">定价单元编码</th>
                        <th data-field="busiz_desc">定价单元描述</th>
                        <th data-align="center" data-formatter="FtpBusizObj.typeFormatter">属性</th>
                        <th data-field="busiz_up_id" data-formatter="FtpBusizObj.upBusizId">上级编码</th>
                        <th data-field="ftp_method_id" data-formatter="FtpBusizObj.methodFormatter">定价方法</th>
                        <th data-field="curve_desc">选配曲线</th>
                        <th data-align="center" data-formatter="FtpBusizObj.termformatter">指定期限</th>
                        <th data-field="point_val">利差(BP)</th>
                        <th data-align="center" data-formatter="FtpBusizObj.flagformatter">是否定价</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    $(document).ready(function () {
        var hwindow = document.documentElement.clientHeight;
        $("#h-ftp-busiz-info-tree-info").height(hwindow-130);
        $("#h-ftp-busiz-info-table-info").height(hwindow-130);
        $("#h-ftp-busiz-info-tree-info-list").height(hwindow-204);
        // 使用js初始化bootstrapTable
        // 获取用户默认能够访问到的数据信息
        $("#h-ftp-busiz-info-table-details").bootstrapTable({
            height:document.documentElement.clientHeight-130,
            url:'/v1/ftp/rules/manage/get',
        });
    });

    var FtpBusizObj = {
        $table:$('#h-ftp-busiz-info-table-details'),
        add:function(){
            $.Hmodal({
                body:$("#h-ftp-busiz-manage-input-form").html(),
                height:"480px",
                width:"720px",
                header:"新增定价单元信息",
                callback:function(hmode){
                    $.HAjaxRequest({
                        url:"/v1/ftp/rules/manage/post",
                        data:$("#h-ftp-busiz-info-add").serialize(),
                        type:"post",
                        success:function () {
                            $.Notify({
                                title:"操作成功",
                                message:"插入机构信息成功",
                                type:"success",
                            });
                            $(hmode).remove();
                            var domain_id = $("#h-ftp-busiz-domain-list").val()
                            FtpBusizObj.tree(domain_id)
                            FtpBusizObj.$table.bootstrapTable("refresh")
                        },
                    })
                },
                preprocess:function(){
                    $.getJSON("/v1/auth/domain/owner",function(data){
                        var arr = new Array()
                        $(data).each(function(index,element){
                            var ijs = {}
                            ijs.id=element.domain_id
                            ijs.text=element.domain_desc
                            ijs.upId="####hzwy23###"
                            arr.push(ijs)
                        });
                        $("#h-ftp-busiz-manage-domain-up-id").Hselect({
                            data:arr,
                            height:"30px",
                            onclick:function(){
                                // TODO
                                var domain_id = $("#h-ftp-busiz-manage-domain-up-id").val()
                                $.getJSON("/v1/ftp/rules/manage/nodes/get",{domain_id:domain_id},function(data){
                                    var arr = new Array()
                                    $(data).each(function(index,element){
                                        var ijs = {}
                                        ijs.id=element.busiz_id;
                                        ijs.text=element.busiz_desc;
                                        ijs.upId=element.busiz_up_id;
                                        arr.push(ijs)
                                    });

                                    var ijs = {};
                                    ijs.id="-1";
                                    ijs.text="定价规则树根节点";
                                    ijs.upId="##hzwy23##";
                                    arr.push(ijs)

                                    $("#h-ftp-busiz-up-id-form").Hselect({
                                        data:arr,
                                        height:"30px",
                                    })
                                });
                                $.getJSON("/v1/ftp/curve/define/list",{domain_id:domain_id},function (data) {
                                    var arr = new Array()
                                    $(data).each(function (index, element) {
                                        var e = {}
                                        e.id=element.curve_id
                                        e.text = element.curve_desc
                                        e.upId = "##hzwy23##"
                                        arr.push(e)
                                    });
                                    $("#h-ftp-busiz-curve-id-form").Hselect({
                                        height:"30px",
                                        data:arr,
                                    })

                                })
                            },
                        });
                        var domain_id = $("#h-ftp-busiz-domain-list").val()
                        $("#h-ftp-busiz-manage-domain-up-id").val(domain_id).trigger("change");

                    });
                    $("#h-ftp-busiz-method-list-form").Hselect({
                        value:"102",
                        height:"30px",
                        onclick:function () {
                           var ftp_method_id = $("#h-ftp-busiz-method-list-form").val();
                           switch (ftp_method_id){
                               case "101":
                                   $("#h-ftp-busiz-curve-id-form").parent().show()
                                   $("#h-ftp-busiz-method-list-form").parent().show()
                                   $("#h-ftp-busiz-flag-form").parent().show()
                                   $("#h-ftp-special-term-cn-form").show()
                                   $("#h-ftp-busiz-term-mult-form").parent().show()
                                   $("#h-ftp-busiz-rep-form").hide()
                                   $("#h-ftp-busiz-point-val-form").hide()
                                   break;
                               case "102":
                               case "105":
                               case "103":
                                   $("#h-ftp-busiz-curve-id-form").parent().show()
                                   $("#h-ftp-busiz-method-list-form").parent().show()
                                   $("#h-ftp-busiz-flag-form").parent().show()
                                   $("#h-ftp-special-term-cn-form").hide()
                                   $("#h-ftp-busiz-term-mult-form").parent().hide()
                                   $("#h-ftp-busiz-rep-form").hide()
                                   $("#h-ftp-busiz-point-val-form").hide()
                                   break;
                               case "104":
                                   $("#h-ftp-busiz-curve-id-form").parent().show()
                                   $("#h-ftp-busiz-method-list-form").parent().show()
                                   $("#h-ftp-busiz-flag-form").parent().show()
                                   $("#h-ftp-special-term-cn-form").hide()
                                   $("#h-ftp-busiz-term-mult-form").parent().hide()
                                   $("#h-ftp-busiz-rep-form").show()
                                   $("#h-ftp-busiz-point-val-form").hide()
                                   break;
                               case "106":
                                   $("#h-ftp-busiz-curve-id-form").parent().hide()
                                   $("#h-ftp-busiz-method-list-form").parent().show()
                                   $("#h-ftp-busiz-flag-form").parent().show()
                                   $("#h-ftp-special-term-cn-form").hide()
                                   $("#h-ftp-busiz-term-mult-form").parent().hide()
                                   $("#h-ftp-busiz-rep-form").hide()
                                   $("#h-ftp-busiz-point-val-form").show()
                                   break;
                               default:
                                   $.Notify({
                                       title:"温馨提示：",
                                       message:"定价方法异常",
                                       type:"info",
                                   })
                           }
                        },
                    });

                    $("#h-ftp-busiz-attr-form").Hselect({
                        value:"1",
                        height:"30px",
                        onclick:function () {
                            var busiz_attr = $("#h-ftp-busiz-attr-form").val();
                            if (busiz_attr == 0) {
                                $("#h-ftp-busiz-curve-id-form").parent().hide()
                                $("#h-ftp-special-term-cn-form").hide()
                                $("#h-ftp-busiz-method-list-form").parent().hide()
                                $("#h-ftp-busiz-flag-form").parent().hide()
                                $("#h-ftp-busiz-term-mult-form").parent().hide()
                                $("#h-ftp-busiz-rep-form").hide()
                                $("#h-ftp-busiz-point-val-form").hide()
                            } else if (busiz_attr == 1){
                                $("#h-ftp-busiz-curve-id-form").parent().show()
                                $("#h-ftp-busiz-method-list-form").parent().show()
                                $("#h-ftp-busiz-flag-form").parent().show()
                                $("#h-ftp-special-term-cn-form").hide()
                                $("#h-ftp-busiz-term-mult-form").parent().hide()
                                $("#h-ftp-busiz-rep-form").hide()
                                $("#h-ftp-busiz-point-val-form").hide()
                            } else {
                                $.Notify({
                                    title:"温馨提示：",
                                    message:"定价单元节点信息异常",
                                    type:"info",
                                })
                            }
                        },
                    });

                    $("#h-ftp-busiz-flag-form").Hselect({
                        value:"0",
                        height:"30px",
                        onclick:function () {
                            var ftp_flag = $("#h-ftp-busiz-flag-form").val();
                            // 定价
                            if (ftp_flag == 0) {
                                $("#h-ftp-busiz-curve-id-form").parent().show()
                                $("#h-ftp-special-term-cn-form").hide()
                                $("#h-ftp-busiz-method-list-form").parent().show()
                                $("#h-ftp-busiz-flag-form").parent().show()
                                $("#h-ftp-busiz-term-mult-form").parent().hide()
                                $("#h-ftp-busiz-rep-form").hide()
                                $("#h-ftp-busiz-point-val-form").hide()
                            } else if (ftp_flag == 1){
                                // 不定价
                                $("#h-ftp-busiz-flag-form").parent().show()
                                $("#h-ftp-busiz-curve-id-form").parent().hide()
                                $("#h-ftp-busiz-method-list-form").parent().hide()
                                $("#h-ftp-special-term-cn-form").hide()
                                $("#h-ftp-busiz-term-mult-form").parent().hide()
                                $("#h-ftp-busiz-rep-form").hide()
                                $("#h-ftp-busiz-point-val-form").hide()
                            } else {
                                $.Notify({
                                    title:"温馨提示：",
                                    message:"定价单元节点信息异常",
                                    type:"info",
                                })
                            }
                        },
                    });

                    $("#h-ftp-busiz-term-mult-form").Hselect({
                        value:"M",
                        height:"30px",
                    });

                }
            })
        },
        edit:function () {
            var rows = $("#h-ftp-busiz-info-table-details").bootstrapTable('getSelections');
            if (rows.length == 0) {
                var selected = $("#h-ftp-busiz-info-tree-info-list").attr("data-selected")
                if (selected == null) {
                    $.Notify({
                        title:"温馨提示:",
                        message:"请选择一个定价单元进行编辑",
                        type:"info",
                    })
                    return
                }
                rows.push($("#h-ftp-busiz-info-table-details").bootstrapTable('getRowByUniqueId',selected))
            } else if ( rows.length > 1) {
                $.Notify({
                    title:"温馨提示:",
                    message:"您选择了多个定价单元,不知道您要编辑哪一个",
                    type:"info",
                })
                return
            }

            $.Hmodal({
                body:$("#h-ftp-busiz-manage-input-form").html(),
                height:"480px",
                width:"720px",
                header:"编辑定价单元信息,域和叶子属性无法修改",
                callback:function(hmode){
                    $.HAjaxRequest({
                        url:"/v1/ftp/rules/manage/put",
                        data:$("#h-ftp-busiz-info-add").serialize(),
                        type:"put",
                        success:function () {
                            $.Notify({
                                title:"操作成功",
                                message:"插入机构信息成功",
                                type:"success",
                            });
                            $(hmode).remove();
                            var domain_id = $("#h-ftp-busiz-domain-list").val()
                            FtpBusizObj.tree(domain_id)
                            FtpBusizObj.$table.bootstrapTable("refresh")
                        },
                    })
                },
                preprocess:function(){
                    // TODO
                    var domain_id = $("#h-ftp-busiz-manage-domain-up-id").val()
                    $.getJSON("/v1/ftp/rules/manage/nodes/get",{domain_id:domain_id},function(data){
                        var arr = new Array()
                        $(data).each(function(index,element){
                            var ijs = {}
                            ijs.id=element.busiz_id;
                            ijs.text=element.busiz_desc;
                            ijs.upId=element.busiz_up_id;
                            arr.push(ijs)
                        });

                        var ijs = {};
                        ijs.id="-1";
                        ijs.text="定价规则树根节点";
                        ijs.upId="##hzwy23##";
                        arr.push(ijs)

                        $("#h-ftp-busiz-up-id-form").Hselect({
                            data:arr,
                            height:"30px",
                            value:rows[0].busiz_up_id,
                        })
                    });
                    $.getJSON("/v1/ftp/curve/define/list",{domain_id:domain_id},function (data) {
                        var arr = new Array()
                        $(data).each(function (index, element) {
                            var e = {}
                            e.id=element.curve_id
                            e.text = element.curve_desc
                            e.upId = "##hzwy23##"
                            arr.push(e)
                        });
                        $("#h-ftp-busiz-curve-id-form").Hselect({
                            height:"30px",
                            data:arr,
                            value:rows[0].curve_id,
                        })

                    });

                    $.getJSON("/v1/auth/domain/self/owner",function(data){
                        var arr = new Array()
                        $(data.owner_list).each(function(index,element){
                            var ijs = {}
                            ijs.id=element.domain_id
                            ijs.text=element.domain_desc
                            ijs.upId="####hzwy23###"
                            arr.push(ijs)
                        });

                        $("#h-ftp-busiz-manage-domain-up-id").Hselect({
                            data:arr,
                            height:"30px",
                            value:data.domain_id,
                            disabled:true,
                        });
                    });

                    $("#h-ftp-busiz-method-list-form").Hselect({
                        value:"102",
                        height:"30px",
                        onclick:function () {
                            var ftp_method_id = $("#h-ftp-busiz-method-list-form").val();
                            switch (ftp_method_id){
                                case "101":
                                    $("#h-ftp-busiz-curve-id-form").parent().show()
                                    $("#h-ftp-busiz-method-list-form").parent().show()
                                    $("#h-ftp-busiz-flag-form").parent().show()
                                    $("#h-ftp-special-term-cn-form").show()
                                    $("#h-ftp-busiz-term-mult-form").parent().show()
                                    $("#h-ftp-busiz-rep-form").hide()
                                    $("#h-ftp-busiz-point-val-form").hide()
                                    break;
                                case "102":
                                case "105":
                                case "103":
                                    $("#h-ftp-busiz-curve-id-form").parent().show()
                                    $("#h-ftp-busiz-method-list-form").parent().show()
                                    $("#h-ftp-busiz-flag-form").parent().show()
                                    $("#h-ftp-special-term-cn-form").hide()
                                    $("#h-ftp-busiz-term-mult-form").parent().hide()
                                    $("#h-ftp-busiz-rep-form").hide()
                                    $("#h-ftp-busiz-point-val-form").hide()
                                    break;
                                case "104":
                                    $("#h-ftp-busiz-curve-id-form").parent().show()
                                    $("#h-ftp-busiz-method-list-form").parent().show()
                                    $("#h-ftp-busiz-flag-form").parent().show()
                                    $("#h-ftp-special-term-cn-form").hide()
                                    $("#h-ftp-busiz-term-mult-form").parent().hide()
                                    $("#h-ftp-busiz-rep-form").show()
                                    $("#h-ftp-busiz-point-val-form").hide()
                                    break;
                                case "106":
                                    $("#h-ftp-busiz-curve-id-form").parent().hide()
                                    $("#h-ftp-busiz-method-list-form").parent().show()
                                    $("#h-ftp-busiz-flag-form").parent().show()
                                    $("#h-ftp-special-term-cn-form").hide()
                                    $("#h-ftp-busiz-term-mult-form").parent().hide()
                                    $("#h-ftp-busiz-rep-form").hide()
                                    $("#h-ftp-busiz-point-val-form").show()
                                    break;
                            }
                        },
                    });

                    $("#h-ftp-busiz-attr-form").Hselect({
                        value:"1",
                        height:"30px",
                        value:rows[0].busiz_type,
                        disabled:true,
                    });

                    if (rows[0].busiz_type == 0) {
                        // 节点
                        $("#h-ftp-busiz-curve-id-form").parent().hide()
                        $("#h-ftp-special-term-cn-form").hide()
                        $("#h-ftp-busiz-method-list-form").parent().hide()
                        $("#h-ftp-busiz-flag-form").parent().hide()
                        $("#h-ftp-busiz-term-mult-form").parent().hide()
                        $("#h-ftp-busiz-rep-form").hide()
                        $("#h-ftp-busiz-point-val-form").hide()

                        $("#h-ftp-busiz-flag-form").Hselect({
                            value: "0",
                            height: "30px",
                            data:[{id:"1",text:"不定价",upId:"-1"}],
                            disabled:true,
                        });
                    } else if (rows[0].busiz_type == 1){
                        // 叶子
                        $("#h-ftp-busiz-curve-id-form").parent().show()
                        $("#h-ftp-busiz-method-list-form").parent().show()
                        $("#h-ftp-busiz-flag-form").parent().show()
                        $("#h-ftp-special-term-cn-form").hide()
                        $("#h-ftp-busiz-term-mult-form").parent().hide()
                        $("#h-ftp-busiz-rep-form").hide()
                        $("#h-ftp-busiz-point-val-form").hide()

                        $("#h-ftp-busiz-flag-form").Hselect({
                            value:"0",
                            height:"30px",
                            onclick:function () {
                                var ftp_flag = $("#h-ftp-busiz-flag-form").val();
                                // 定价
                                if (ftp_flag == 0) {
                                    $("#h-ftp-busiz-curve-id-form").parent().show()
                                    $("#h-ftp-special-term-cn-form").hide()
                                    $("#h-ftp-busiz-method-list-form").parent().show()
                                    $("#h-ftp-busiz-flag-form").parent().show()
                                    $("#h-ftp-busiz-term-mult-form").parent().hide()
                                    $("#h-ftp-busiz-rep-form").hide()
                                    $("#h-ftp-busiz-point-val-form").hide()
                                } else if (ftp_flag == 1){
                                    // 不定价
                                    $("#h-ftp-busiz-flag-form").parent().show()
                                    $("#h-ftp-busiz-curve-id-form").parent().hide()
                                    $("#h-ftp-busiz-method-list-form").parent().hide()
                                    $("#h-ftp-special-term-cn-form").hide()
                                    $("#h-ftp-busiz-term-mult-form").parent().hide()
                                    $("#h-ftp-busiz-rep-form").hide()
                                    $("#h-ftp-busiz-point-val-form").hide()
                                } else {
                                    $.Notify({
                                        title:"温馨提示：",
                                        message:"定价单元节点信息异常",
                                        type:"info",
                                    })
                                }
                            },
                        });
                    } else {
                        $.Notify({
                            title:"温馨提示：",
                            message:"定价单元节点信息异常",
                            type:"info",
                        })
                    }

                    $("#h-ftp-busiz-term-mult-form").Hselect({
                        value:"M",
                        height:"30px",
                        value:rows[0].term_cd_mult,
                    });

                    $("#h-ftp-busiz-info-add").find("input[name='busiz_id']").val(rows[0].code_number);
                    $("#h-ftp-busiz-info-add").find("input[name='busiz_desc']").val(rows[0].busiz_desc);
                    $("#h-ftp-busiz-info-add").find("input[name='term_cd']").val(rows[0].term_cd);


                    $("#h-ftp-busiz-flag-form").val(rows[0].ftp_flag).trigger("change");
                    $("#h-ftp-busiz-method-list-form").val(rows[0].ftp_method_id).trigger("change");
                    $("#point_val").val(rows[0].point_val);

                }
            })
        },
        getSubBusiz:function(set,all){

            var addArray = new Array();

            var search = function(obj,arr){
                $(arr).each(function(index,element){
                    if (obj.busiz_id == element.busiz_up_id){
                        addArray.push(element)
                        var newArray = all.splice(index,1)
                        search(element,newArray)
                    }
                });
            };

            $(set).each(function(index,element){
                search(element,all)
            });

            return addArray
        },
        delete:function () {
            var domain_id = $("#h-ftp-busiz-domain-list").val();

            var data = FtpBusizObj.$table.bootstrapTable("getSelections").concat();
            var alldata = FtpBusizObj.$table.bootstrapTable('getData');

            // 将数组中的值复制一份
            var all = alldata.concat()
            if (data.length == 0){
                $.Notify({
                    title:"温馨提示",
                    message:"您没有在下列责任中心信息表中选择需要删除的机构",
                    type:"info",
                })
                return
            } else {
                $.Hconfirm({
                    preprocess:function () {

                        var deletedata = FtpBusizObj.getSubBusiz(data,all);

                        $(deletedata).each(function (index, element) {
                            data.push(element)
                        });

                    },
                    callback:function () {
                        $.HAjaxRequest({
                            url:"/v1/ftp/rules/manage/delete",
                            type:"post",
                            data:{JSON:JSON.stringify(data),domain_id:domain_id},
                            success:function () {
                                $.Notify({
                                    title:"温馨提示：",
                                    message:"删除机构信息成功",
                                    type:"success",
                                });
                                FtpBusizObj.$table.bootstrapTable("refresh")
                                FtpBusizObj.tree(domain_id)
                            },
                        })
                    },
                    header:"删除定价单元信息",
                    body:"<div style='height: 90px; line-height: 90px; font-size: 16px;font-weight: 500;width: 340px; text-align: center;'>确认要删除选中的定价单元信息吗？</div>"
                })
            }
        },
        // table表中信息查询参数
        queryParams:function (params) {
            params.domain_id = $("#h-ftp-busiz-domain-list").val();
            return params
        },
        download:function(){
            var domain_id = $("#h-ftp-busiz-domain-list").val()
            var x=new XMLHttpRequest();
            x.open("GET", "/v1/auth/resource/org/download?domain_id="+domain_id, true);
            x.responseType = 'blob';
            x.onload=function(e){
                download(x.response, "机构信息.xlsx", "application/vnd.ms-excel" );
            }
            x.send();
        },
        upload:function(){
            $.Notify({
                title:"非常抱歉",
                message:"目前没有权限使用导出数据功能",
                type:"info",
            })
        },
        tree:function(domain_id){
            $.getJSON("/v1/ftp/rules/manage/get",{domain_id:domain_id},function(data){
                if (data.length==0){
                    FtpBusizObj.$table.bootstrapTable('load',[])
                    $("#h-ftp-busiz-info-tree-info-list").Htree({
                        data:[],
                    })
                } else {
                    var arr = new Array()
                    $(data).each(function(index,element){
                        var ijs = {}
                        ijs.id = element.busiz_id
                        ijs.text = element.busiz_desc
                        ijs.upId = element.busiz_up_id
                        arr.push(ijs)
                    });
                    $("#h-ftp-busiz-info-tree-info-list").Htree({
                        data:arr,
                        onChange:function(obj){
                            // TODO
                            var id = $(obj).attr("data-id")
                            $.getJSON("/v1/ftp/rules/manage/sub/query",{busiz_id:id},function(data){
                                FtpBusizObj.$table.bootstrapTable('load',data)
                            });
                        }
                    });
                }
            })
        },
        upBusizId:function(value,row,index){
            var upcombine = row.busiz_up_id.split("_join_")
            if (upcombine.length==2){
                return upcombine[1]
            }else{
                return upcombine
            }
        },
        setRedemptionValue:function (busiz_id) {
            $.Notify({
                title:"温馨提示:",
                message:"正在维护中",
                type:"info",
            })
        },
        methodFormatter:function (value,row,index) {
            switch (row.ftp_method_id) {
                case "101":
                    return "指定期限法"
                case "102":
                    return "直接期限匹配法"
                case "103":
                    return "现金流加权期限发"
                case "104":
                    return "偿还曲线法"
                case "105":
                    return "久期法"
                case "106":
                    return "利率代码差额法"
                default:
                    return "<span>-</span>"
            }
        },
        termformatter:function (value, row, index) {
            if (row.ftp_method_id == "104"){
                return "<span class='h-td-btn' style='color: #761c19'>设置</span>"
            }
            if (row.ftp_method_id == "101"){
                return row.term_cd+row.term_cd_mult
            }

        },
        flagformatter:function (value, row, index){
            if (row.busiz_type == "0"){
                return "-"
            }
            switch (row.ftp_flag) {
                case "0":
                    return "<span style='color: #009966;font-weight: 600; font-size: 12px;'>定价</span>"
                case "1":
                    return "<span style='color: red;font-weight: 600; font-size: 12px;'>不定价</span>"
                default:
                    return "-"
            }
        },
        typeFormatter:function (value, row, index) {
            switch (row.busiz_type) {
                case "0":
                    return "节点"
                case "1":
                    return "叶子"
                default:
                    return "-"
            }
        }
    };

    $(document).ready(function(){

        // 初始化左侧树形展示区域信息。
        FtpBusizObj.tree();

        // 获取用户能够访问到的域信息
        $.getJSON("/v1/auth/domain/self/owner",function(data){
            var arr = new Array();
            $(data.owner_list).each(function(index,element){
                var ijs = {}
                ijs.id=element.domain_id
                ijs.text=element.domain_desc
                ijs.upId="####hzwy23###"
                arr.push(ijs)
            });

            $("#h-ftp-busiz-domain-list").Hselect({
                data:arr,
                height:"24px",
                width:"180px",
                value:data.domain_id,
                onclick:function () {
                    // 当选择框值改变信息触发时，执行这块函数
                    var domain_id = $("#h-ftp-busiz-domain-list").val()
                    // 根据所选择的的域，刷新左侧的树形展示区域
                    FtpBusizObj.tree(domain_id)
                    // 刷新bootstrapTable中数据信息
                    FtpBusizObj.$table.bootstrapTable("refresh")
                },
            });
        });
    });
</script>

<script type="text/html" id="h-ftp-busiz-manage-input-form">
    <form  id="h-ftp-busiz-info-add">
        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6">
            <label class="h-label" style="width:100%;">定价单元编码：</label>
            <input placeholder="请输入1-30位数字，字母（必填）" name="busiz_id" type="text" class="form-control" style="width: 100%;height: 30px;line-height: 30px;">
        </div>
        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6">
            <label class="h-label" style="width: 100%;">定价单元名称：</label>
            <input placeholder="请输入1-60位汉字，字母，数字（必填）" type="text" class="form-control" name="busiz_desc" style="width: 100%;height: 30px;line-height: 30px;">
        </div>

        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;">
            <label class="h-label" style="width: 100%;">所属域：</label>
            <select id="h-ftp-busiz-manage-domain-up-id" name="domain_id" style="width: 100%;height: 30px;line-height: 30px;">
            </select>
        </div>

        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;">
            <label class="h-label" style="width: 100%;">上级定价单元：</label>
            <select id="h-ftp-busiz-up-id-form" name="busiz_up_id" style="width: 100%;height: 30px;line-height: 30px;">
            </select>
        </div>

        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;">
            <label class="h-label" style="width: 100%;">是否叶子：</label>
            <select id="h-ftp-busiz-attr-form" name="busiz_attr" style="width: 100%;height: 30px;line-height: 30px;">
                <option value="0">节点</option>
                <option value="1">叶子</option>
            </select>
        </div>
        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;">
            <label class="h-label" style="width: 100%;">是否定价：</label>
            <select id="h-ftp-busiz-flag-form" name="ftp_flag" style="width: 100%;height: 30px;line-height: 30px;">
                <option value="0">定价</option>
                <option value="1">不定价</option>
            </select>
        </div>

        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;">
            <label class="h-label" style="width: 100%;">定价方法：</label>
            <select id="h-ftp-busiz-method-list-form" name="ftp_method_id" style="width: 100%;height: 30px;line-height: 30px;">
                <option value="101">指定期限法</option>
                <option value="102">直接期限匹配法</option>
                <option value="103">现金流加权期限法</option>
                <option value="104">偿还曲线法</option>
                <option value="105">久期法</option>
                <option value="106">利率代码差额法</option>
            </select>
        </div>
        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;">
            <label class="h-label" style="width: 100%;">适配曲线：</label>
            <select id="h-ftp-busiz-curve-id-form" name="curve_id" style="width: 100%;height: 30px;line-height: 30px;">
            </select>
        </div>


        <div id="h-ftp-special-term-cn-form" class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="margin-top: 15px;display: none;">
            <label class="h-label" style="width: 100%;">指定期限：</label>
            <input name="term_cd" class="form-control" style="width: 100%;height: 30px;line-height: 30px;" />
        </div>

        <div class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="display: none;margin-top: 15px;">
            <label class="h-label" style="width: 100%;">指定期限单位：</label>
            <select id="h-ftp-busiz-term-mult-form" name="term_cd_mult" style="width: 100%;height: 30px;line-height: 30px;">
                <option value="D">日</option>
                <option value="M">月</option>
                <option value="Y">年</option>
            </select>
        </div>


        <div id="h-ftp-busiz-rep-form" class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="display: none;margin-top: 15px;">
            <!--<label class="h-label" style="width: 100%;">偿还曲线权重值：</label>-->
            <button type="button" onclick="FtpBusizObj.setRedemptionValue()" class="btn btn-sm btn-success">设置偿还曲线重定价权重信息</button>
        </div>

        <div id="h-ftp-busiz-point-val-form" class="form-group-sm col-sm-6 col-md-6 col-lg-6" style="display: none;margin-top: 15px;">
            <label class="h-label" style="width: 100%;">利率代码差额值：</label>
            <input id="point_val" name="point_val" class="form-control" style="width: 100%;height: 30px;line-height: 30px;" />
        </div>

    </form>
</script>